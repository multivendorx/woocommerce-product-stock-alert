"use strict";jQuery(function(e){var s={init:function(){console.log(localizeData.nonce),e(document).on("click",".stock-manager-button",this.subscribe_form),e(document).on("click",".unsubscribe_button",this.unsubscribe_form),e(document).on("change","input.variation_id",this.getVariationSubscribeForm)},getVariationSubscribeForm:function(){let s=Number(e(this).val()),i=Number(e(".stock-notifier-shortcode-subscribe-form").data("product-id"));if(e(".stock-notifier-shortcode-subscribe-form").length&&s){let r={action:"get_variation_box_ajax",nonce:localizeData.nonce,product_id:i,variation_id:s};e.post(localizeData.ajax_url,r,function(s){e(".stock-notifier-shortcode-subscribe-form").html(s)})}else e(".stock-notifier-shortcode-subscribe-form").html("")},is_email:function(e){return!!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},unsubscribe_form:function(s){s.preventDefault(),e(this).text(localizeData.processing),e(this).addClass("stk_disabled");let i=e(this).closest(".stock-notifier-subscribe-form"),r={action:"unsubscribe_button",nonce:localizeData.nonce,customer_email:i.find(".subscribed_email").val(),product_id:i.find(".product_id").val(),var_id:i.find(".variation_id").val()},t=localizeData.alert_unsubscribe_message;t=t.replace("%customer_email%",r.customer_email),e.post(localizeData.ajax_url,r,function(s){e(this).removeClass("stk_disabled"),!0==s?e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+t+"</div>"):e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+localizeData.error_occurs+'<a href="'+window.location+'"> '+localizeData.try_again+"</a></div>")})},subscribe_form:function(i){i.preventDefault(),e(this).text(localizeData.processing),e(this).addClass("stk_disabled");let r=localizeData.recaptcha_enabled,t=e(this).closest(".stock-notifier-subscribe-form");if(r){let a=t.find("#recaptchav3_secretkey").val(),o=t.find("#recaptchav3_response").val(),c={action:"recaptcha_validate_ajax",nonce:localizeData.nonce,captcha_secret:a,captcha_response:o};e.post(localizeData.ajax_url,c,function(i){1==i?s.process_form(t.find(".stock-manager-email").val(),t.find(".current-product-id").val(),t.find(".current-variation-id").val(),t.find(".current-product-name").val()):(alert("Oops, recaptcha not varified!"),e(this).removeClass("stk_disabled"))})}else s.process_form(t.find(".stock-manager-email").val(),t.find(".current-product-id").val(),t.find(".current-variation-id").val(),t.find(".current-product-name").val())},process_form:function(i,r,t,a){var o=localizeData.button_html,c=localizeData.alert_success,n=localizeData.alert_email_exist,l=localizeData.valid_email,d=localizeData.ban_email_domain_text,u=localizeData.ban_email_address_text,m=localizeData.double_opt_in_success,b=localizeData.unsubscribe_button,c=c.replace("%product_title%",a),c=c.replace("%customer_email%",i),n=n.replace("%product_title%",a),n=n.replace("%customer_email%",i);if(i&&s.is_email(i)){e(this).toggleClass("alert_loader").blur();for(var f={action:"alert_ajax",nonce:localizeData.nonce,email:i,product_id:r,variation_id:t},p=0;p<localizeData.additional_fields.length;p++)f[localizeData.additional_fields[p]]=e("#woo_stock_manager_"+localizeData.additional_fields[p]).val();e.post(localizeData.ajax_url,f,function(s){"0"==s?e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+localizeData.error_occurs+'<a href="'+window.location+'"> '+localizeData.try_again+"</a></div>"):"/*?%already_registered%?*/"==s?e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+n+"</div>"+b+'<input type="hidden" class="subscribed_email" value="'+i+'" /><input type="hidden" class="product_id" value="'+r+'" /><input type="hidden" class="variation_id" value="'+t+'" />'):"/*?%ban-email-address%?*/"==s?e(".responsedata-error-message").remove()&&e(".stock-notifier-subscribe-form").append(e(`<p class="responsedata-error-message ban-email-address">${u}</p>`)):"/*?%ban_email_domain%?*/"==s?e(".responsedata-error-message").remove()&&e(".stock-notifier-subscribe-form").append(e(`<p class="responsedata-error-message ban-email-address">${d}</p>`)):"/*?%double_opt_in%?*/"==s?e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+m+"</div>"):e(".stock-notifier-subscribe-form").html('<div class="registered-message">'+c+"</div>"),e(".stock-manager-button").replaceWith(o)})}else e(".responsedata-error-message").remove()&&e(".stock-notifier-subscribe-form").append(e(`<p style="color:#e2401c;" class="responsedata-error-message">${l}</p>`)),e(".stock-manager-button").replaceWith(o)}};s.init()});